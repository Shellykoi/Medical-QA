# 医疗知识图谱问答系统 - 完整项目文档

## 📋 项目概述

这是一个基于医疗知识图谱的智能问答系统，能够回答关于疾病症状、病因、治疗方法等医疗相关问题。系统使用Python开发，支持多种运行方式，无需复杂的数据库配置即可运行。

## 🎯 项目特色

- 🎨 **现代化Web界面**：美观简洁的全屏设计
- 💬 **智能问答系统**：支持18种问题类型
- 🕸️ **知识图谱可视化**：基于Neo4j的图形数据库
- 📊 **数据统计展示**：实时显示数据规模
- 🔄 **在线知识图谱构建**：Web界面一键构建
- 📱 **响应式设计**：支持移动端访问

## 🚀 快速开始

### 环境要求

- Python 3.6+
- 无需额外安装数据库（使用JSON数据文件）

### 安装依赖

```bash
# 安装Python依赖包
python3 -m pip install -r requirements.txt
```

### 运行方式

#### 1. Web前端界面（推荐）

```bash
# 启动Web服务器
python3 web_server.py

# 访问界面
# 浏览器打开：http://localhost:8080
```

**特色功能：**
- 🎨 现代化Web界面，美观简洁
- 💬 类似聊天软件的对话体验
- ⚡ 实时问答交互
- 📱 响应式设计，支持手机访问
- 🔍 智能问题识别
- 💡 示例问题快速提问

#### 2. GUI图形界面

```bash
# 运行GUI界面
python3 medical_qa_gui.py
```

**特色功能：**
- 白色背景，简洁淡雅
- 更大的字体，提升可读性
- 直观的对话界面
- 实时问答交互
- 示例问题快速提问
- 对话记录管理
- 多线程处理，界面不卡顿

#### 3. 命令行模式

```bash
# 演示模式
python3 medical_qa_system.py demo

# 交互模式
python3 medical_qa_system.py
```

## 📊 项目数据

### 数据规模

- **疾病节点**：8,807个
- **症状节点**：5,998个
- **药物节点**：2,000+个
- **关系数量**：300K+
- **实体总数**：44,111个（约4.4万实体量级）

### 数据文件

- **主数据文件**：`data/medical.json` - 包含8807个疾病信息
- **词典文件**：`dict/` 目录下的各种词典文件
  - `disease.txt` - 疾病词典
  - `symptom.txt` - 症状词典
  - `drug.txt` - 药品词典
  - `food.txt` - 食物词典
  - `check.txt` - 检查项目词典

### 知识图谱结构

#### 实体类型

| 实体类型 | 中文含义 | 实体数量 | 举例 |
| :--- | :---: | :---: | :--- |
| Check | 诊断检查项目 | 3,353| 支气管造影;关节镜检查|
| Department | 医疗科目 | 54 |  整形美容科;烧伤科|
| Disease | 疾病 | 8,807 |  血栓闭塞性脉管炎;胸降主动脉动脉瘤|
| Drug | 药品 | 3,828 |  京万红痔疮膏;布林佐胺滴眼液|
| Food | 食物 | 4,870 |  番茄冲菜牛肉丸汤;竹笋炖羊肉|
| Producer | 在售药品 | 17,201 |  通药制药青霉素V钾片;青阳醋酸地塞米松片|
| Symptom | 疾病症状 | 5,998 |  乳腺组织肥厚;脑实质深部出血|

#### 关系类型

| 实体关系类型 | 中文含义 | 关系数量 | 举例|
| :--- | :---: | :---: | :--- |
| belongs_to | 属于 | 8,844| <妇科,属于,妇产科>|
| common_drug | 疾病常用药品 | 14,649 | <阳强,常用,甲磺酸酚妥拉明分散片>|
| do_eat |疾病宜吃食物 | 22,238| <胸椎骨折,宜吃,黑鱼>|
| drugs_of |  药品在售药品 | 17,315| <青霉素V钾片,在售,通药制药青霉素V钾片>|
| need_check | 疾病所需检查 | 39,422| <单侧肺气肿,所需检查,支气管造影>|
| no_eat | 疾病忌吃食物 | 22,247| <唇病,忌吃,杏仁>|
| recommand_drug | 疾病推荐药品 | 59,467 | <混合痔,推荐用药,京万红痔疮膏>|
| recommand_eat | 疾病推荐食谱 | 40,221 | <鞘膜积液,推荐食谱,番茄冲菜牛肉丸汤>|
| has_symptom | 疾病症状 | 5,998 |  <早期乳腺癌,疾病症状,乳腺组织肥厚>|
| acompany_with | 疾病并发疾病 | 12,029 | <下肢交通静脉瓣膜关闭不全,并发疾病,血栓闭塞性脉管炎>|

## 🔧 Neo4j数据库配置

### 安装Neo4j

#### 方法一：使用Docker（推荐）

```bash
# 安装Docker Desktop
# 访问：https://www.docker.com/products/docker-desktop/

# 运行Neo4j容器
docker run -d \
  --name neo4j \
  -p 7474:7474 \
  -p 7687:7687 \
  -e NEO4J_AUTH=neo4j/password \
  neo4j:5.15.0
```

#### 方法二：手动安装

1. **安装Java**：
   - 访问：https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html
   - 下载并安装JDK 8或11

2. **下载Neo4j**：
   - 访问：https://neo4j.com/download/
   - 下载Neo4j Community Edition
   - 解压到本地目录

3. **启动Neo4j**：
   ```bash
   cd neo4j-community-5.15.0
   ./bin/neo4j start
   ```

#### 方法三：使用Homebrew

```bash
# 安装Homebrew（如果未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装Neo4j
brew install neo4j

# 启动Neo4j
brew services start neo4j
```

### 配置数据库连接

**默认配置：**
- **连接地址**：`bolt://127.0.0.1:7687`
- **用户名**：`neo4j`
- **密码**：`password`

**修改密码：**
1. 访问Neo4j浏览器：http://localhost:7474
2. 首次登录：用户名 `neo4j`，密码 `neo4j`
3. 设置新密码为：`password`

### 构建知识图谱

```bash
# 方法1：通过Web界面
# 访问 http://localhost:8080，点击"知识图谱"标签页，点击"加载知识图谱"

# 方法2：命令行构建
python3 build_medicalgraph.py
```

## 📝 支持的问题类型

| 问句类型 | 中文含义 | 问句举例 |
| :--- | :---: | :---: |
| disease_symptom | 疾病症状| 乳腺癌的症状有哪些？ |
| symptom_disease | 已知症状找可能疾病 | 最近老流鼻涕怎么办？ |
| disease_cause | 疾病病因 | 为什么有的人会失眠？|
| disease_acompany | 疾病的并发症 | 失眠有哪些并发症？ |
| disease_not_food | 疾病需要忌口的食物 | 失眠的人不要吃啥？ |
| disease_do_food | 疾病建议吃什么食物 | 耳鸣了吃点啥？ |
| food_not_disease | 什么病最好不要吃某事物 | 哪些人最好不好吃蜂蜜？ |
| food_do_disease | 食物对什么病有好处| 鹅肉有什么好处？ |
| disease_drug | 啥病要吃啥药 | 肝病要吃啥药？ |
| drug_disease | 药品能治啥病 | 板蓝根颗粒能治啥病？ |
| disease_check | 疾病需要做什么检查 | 脑膜炎怎么才能查出来？|
| check_disease |　检查能查什么病 | 全血细胞计数能查出啥来？ |
| disease_prevent | 预防措施| 怎样才能预防肾虚？ |
| disease_lasttime | 治疗周期 | 感冒要多久才能好？ |
| disease_cureway | 治疗方式 | 高血压要怎么治？ |
| disease_cureprob | 治愈概率 | 白血病能治好吗？ |
| disease_easyget | 疾病易感人群 | 什么人容易得高血压？ |
| disease_desc | 疾病描述 | 糖尿病 |

## 🗂️ 项目文件结构

```
Medical-QA-System/
├── web_server.py              # Web服务器（主程序）
├── templates/
│   └── index.html             # 前端界面
├── medical_qa_gui.py          # GUI界面
├── medical_qa_system.py       # 命令行版本
├── build_medicalgraph.py      # 知识图谱构建
├── prepare_data/
│   ├── data_spider.py         # 数据爬取
│   ├── build_data.py          # 数据处理
│   └── max_cut.py             # 分词处理
├── data/
│   └── medical.json           # 医疗数据（8807个疾病）
├── dict/                      # 词典文件
│   ├── disease.txt
│   ├── symptom.txt
│   ├── drug.txt
│   ├── food.txt
│   └── check.txt
├── requirements.txt           # 依赖包列表
├── README.md                  # 项目说明
└── 项目文档.md               # 本文件
```

## 🔍 数据爬取和处理

### 数据爬取

**爬取目标**：寻医问药网 (jib.xywy.com)

**爬取内容**：
- 疾病基本信息
- 症状信息
- 病因信息
- 预防信息
- 检查信息
- 治疗信息
- 食物信息
- 药物信息

**运行爬取**：
```bash
# 启动数据爬取
python3 prepare_data/data_spider.py

# 数据处理
python3 prepare_data/build_data.py
```

### MongoDB数据处理

**功能**：
- 从MongoDB读取原始数据
- 数据清洗和标准化
- 实体关系提取
- 输出为JSON格式

**运行处理**：
```bash
# 运行MongoDB数据处理
python3 MongoDB数据处理系统.py
```

## 🌐 GitHub使用指南

### 克隆项目

```bash
# 克隆项目到本地
git clone https://github.com/Shellykoi/Medical-QA-System.git
cd Medical-QA-System
```

### 日常开发工作流

```bash
# 拉取最新更改
git pull origin main

# 推送更改
git add .
git commit -m "描述您的更改"
git push origin main

# 查看状态
git status
```

### GitHub配置

**Fine-grained Token权限配置：**

#### Repository permissions（仓库权限）：
- ✅ **Contents**: Read and write
- ✅ **Metadata**: Read
- ✅ **Pull requests**: Read and write
- ✅ **Issues**: Read and write

#### Account permissions（账户权限）：
- 保持为 "No account permissions added yet"

**配置步骤：**
1. 访问：https://github.com/settings/tokens
2. 点击 "Generate new token" -> "Generate new token (fine-grained)"
3. 填写基本信息
4. 设置权限
5. 生成并使用token

## ⚠️ 注意事项

1. **医疗建议**：系统基于预定义的医疗数据，回答仅供参考，不能替代专业医疗建议
2. **及时就医**：如有严重疾病，请及时就医
3. **中文支持**：系统支持中文问答
4. **退出系统**：输入 'quit'、'exit' 或 'q' 可以退出系统

## 🛠️ 技术特点

- 基于词典匹配的实体识别
- 基于关键词的问题分类
- 支持多种问题类型
- 无需数据库配置（使用JSON数据）
- 轻量级实现
- 现代化Web界面
- 知识图谱可视化
- 在线构建功能

## 📞 联系方式

如有问题，可联系：https://liuhuanyong.github.io/

## 🎉 项目总结

本项目完成了从无到有，以垂直网站为数据来源，构建起以疾病为中心的医疗知识图谱，实体规模4.4万，实体关系规模30万。并基于此，搭建起了一个可以回答18类问题的自动问答小系统。

**项目亮点：**
- 美观的全屏Web界面
- 完整的知识图谱问答系统
- 支持多种运行方式
- 数据爬取和处理完整
- 在线知识图谱构建功能

**项目已基本完成所有实验要求，可以正常运行和使用！**
